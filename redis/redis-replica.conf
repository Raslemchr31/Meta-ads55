# Meta Ads Intelligence Platform - Redis Replica Configuration
# Configuration for Redis replicas with production security

# Include main Redis configuration
include /etc/redis/redis.conf

# =======================
# REPLICA-SPECIFIC SETTINGS
# =======================

# Replica configuration
replica-serve-stale-data yes
replica-read-only yes
replica-priority 100

# Authentication for master connection
masterauth "MetaAds2024!SecureRedis#Production$"

# Replication settings
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-ping-replica-period 10
repl-timeout 60
repl-disable-tcp-nodelay no
repl-backlog-size 1mb
repl-backlog-ttl 3600

# Minimum replicas configuration
min-replicas-to-write 1
min-replicas-max-lag 10

# =======================
# PERFORMANCE OPTIMIZATION
# =======================

# Replica output buffer
client-output-buffer-limit replica 256mb 64mb 60

# Lazy freeing for replicas
replica-lazy-flush yes

# =======================
# LOGGING FOR REPLICAS
# =======================

# Separate log file for replica
logfile /var/log/redis/redis-replica.log
syslog-ident redis-replica-meta-ads

# =======================
# MEMORY MANAGEMENT
# =======================

# Replicas can have slightly different memory settings
maxmemory 1.8gb
maxmemory-policy volatile-lru

# =======================
# REPLICA SECURITY
# =======================

# Read-only enforcement
replica-read-only yes

# Disable dangerous commands on replicas
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG ""
rename-command SHUTDOWN ""
rename-command DEBUG ""